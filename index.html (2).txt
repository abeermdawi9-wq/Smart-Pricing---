<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Smart Pricing – Mini | تسعير سريع للمشاريع الصغيرة</title>
<style>
  :root{
    --bg:#f6f8fb; --card:#ffffff; --ink:#0b1a2b; --muted:#5b6774;
    --brand:#8fd3dc; --brand2:#5fb7c2; --line:#e6eef4; --ok:#137a4a;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Kufi Arabic",Tahoma,Arial}
  .wrap{max-width:720px;margin-inline:auto;padding:18px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;box-shadow:0 10px 24px rgba(15,35,55,.06);padding:16px}
  h1{font-size:18px;margin:0 0 10px}
  p.muted{color:var(--muted);margin-top:4px;font-size:13px}
  label{display:block;font-size:13px;color:var(--muted);margin:.4rem 0 .2rem}
  input,select{width:100%;padding:10px;border:1px solid var(--line);border-radius:10px;background:#fff;font-size:15px}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .row>*{flex:1}
  button{appearance:none;border:none;background:linear-gradient(180deg,var(--brand),var(--brand2));color:#05343a;font-weight:800;border-radius:12px;padding:12px 16px;cursor:pointer;width:100%;font-size:16px;box-shadow:0 8px 20px rgba(143,211,220,.35)}
  button:hover{filter:brightness(.97)}
  table{width:100%;border-collapse:collapse;margin-top:12px}
  th,td{padding:10px;border-bottom:1px solid var(--line);text-align:right}
  th{color:var(--muted);font-weight:600}
  .kpi{font-weight:900;font-size:22px;color:var(--ok)}
  footer{margin-top:14px;color:var(--muted);font-size:12px;text-align:center}
  .top{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
  .brand{display:flex;align-items:center;gap:10px}
  .logo{width:46px;height:46px;border-radius:12px;background:linear-gradient(145deg,var(--brand),#d9f1f4);display:grid;place-items:center;color:#fff;font-weight:800;box-shadow:0 8px 20px rgba(143,211,220,.35)}
  .hint{font-size:12px;color:var(--muted)}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="top">
        <div class="brand">
          <div class="logo">SP</div>
          <div>
            <h1>Smart Pricing – Mini</h1>
            <p class="muted">أدخل تكلفة منتجك، وسنحسب لك السعر المقترح للبيع تلقائيًا.</p>
          </div>
        </div>
      </div>

      <div class="row">
        <div>
          <label>تكلفة المنتج (للـوحدة)</label>
          <input id="cost" type="number" step="0.01" placeholder="مثال: 25.00">
        </div>
        <div>
          <label>العملة</label>
          <select id="currency">
            <option value="SAR">ريال سعودي (SAR)</option>
            <option value="USD">دولار (USD)</option>
            <option value="AED">درهم (AED)</option>
            <option value="EGP">جنيه (EGP)</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label>هامش الربح %</label>
          <input id="margin" type="number" step="0.1" value="30">
        </div>
        <div>
          <label>ضريبة القيمة المضافة %</label>
          <input id="vat" type="number" step="0.1" value="15">
        </div>
        <div>
          <label>تقريب السعر</label>
          <select id="rounding">
            <option value="none">بدون تقريب</option>
            <option value="0.5">لأقرب نصف ريال</option>
            <option value="1">لأقرب ريال</option>
            <option value="psych">أقرب .95 (نفسي)</option>
          </select>
        </div>
      </div>

      <div style="margin-top:10px">
        <button id="calcBtn">احسب السعر المناسب للبيع</button>
      </div>

      <table>
        <thead>
          <tr><th>البند</th><th>القيمة</th></tr>
        </thead>
        <tbody id="result">
          <tr><td>تكلفة المنتج</td><td id="r_cost">—</td></tr>
          <tr><td>هامش الربح</td><td id="r_profit">—</td></tr>
          <tr><td>السعر قبل الضريبة</td><td id="r_price_no_vat">—</td></tr>
          <tr><td>ضريبة القيمة المضافة</td><td id="r_vat">—</td></tr>
          <tr><td><strong>السعر النهائي المقترح</strong></td><td class="kpi" id="r_final">—</td></tr>
        </tbody>
      </table>
      <p class="hint">ملاحظة: هذه أداة تعليمية مبسطة للتسعير الأولي، ويمكن تعديل النسب حسب نشاطك.</p>
    </div>
    <footer>© <span id="yy"></span> Smart Pricing – Mini</footer>
  </div>

<script>
  const fmt = (n, curr) => new Intl.NumberFormat('ar-SA', {minimumFractionDigits:2, maximumFractionDigits:2}).format(Number(n||0)) + (curr ? ('\u00A0' + curr) : '');

  function roundPrice(value, mode){
    if(mode === '0.5'){ return Math.round(value*2)/2; }
    if(mode === '1'){ return Math.round(value); }
    if(mode === 'psych'){ // أقرب .95
      const i = Math.floor(value);
      const candidate = i + 0.95;
      if(candidate >= value) return candidate;
      return i + 1 + 0.95 - 1; // التزام .95 للأعلى
    }
    return value;
  }

  function calc(){
    const cost = parseFloat(document.getElementById('cost').value || '0');
    const margin = parseFloat(document.getElementById('margin').value || '0');
    const vat = parseFloat(document.getElementById('vat').value || '0');
    const curr = document.getElementById('currency').value;
    const rounding = document.getElementById('rounding').value;

    if(cost <= 0){
      document.getElementById('r_cost').textContent = '—';
      document.getElementById('r_profit').textContent = '—';
      document.getElementById('r_price_no_vat').textContent = '—';
      document.getElementById('r_vat').textContent = '—';
      document.getElementById('r_final').textContent = '—';
      return;
    }

    const profit = cost * (margin/100);
    const priceNoVAT = cost + profit;
    const vatValue = priceNoVAT * (vat/100);
    let finalPrice = priceNoVAT + vatValue;
    finalPrice = roundPrice(finalPrice, rounding);

    document.getElementById('r_cost').textContent = fmt(cost, curr);
    document.getElementById('r_profit').textContent = fmt(profit, curr);
    document.getElementById('r_price_no_vat').textContent = fmt(priceNoVAT, curr);
    document.getElementById('r_vat').textContent = fmt(vatValue, curr);
    document.getElementById('r_final').textContent = fmt(finalPrice, curr);

    // حفظ الإعدادات للمرة القادمة
    localStorage.setItem('spm_defaults', JSON.stringify({margin, vat, curr, rounding}));
  }

  document.getElementById('calcBtn').addEventListener('click', calc);
  document.getElementById('yy').textContent = new Date().getFullYear();

  // تحميل الإعدادات الافتراضية المحفوظة
  (function(){
    try{
      const s = JSON.parse(localStorage.getItem('spm_defaults') || '{}');
      if(s.margin) document.getElementById('margin').value = s.margin;
      if(s.vat) document.getElementById('vat').value = s.vat;
      if(s.curr) document.getElementById('currency').value = s.curr;
      if(s.rounding) document.getElementById('rounding').value = s.rounding;
    }catch(e){}
  })();
</script>
</body>
</html>
